shiny::runApp('C:/Users/mcherrie/Google Drive/ProjectFiles/CRESHwebmap/webmap')
getwd()
setwd("C:/Users/mcherrie/Google Drive/ProjectFiles/AFS_MC/AFS_onchanges/working")
agesex<-read.csv("data/auxi/agesex.csv")
knitr::opts_chunk$set(echo = TRUE)
#' Setup workspace
setwd("C:/Users/mcherrie/Google Drive/ProjectFiles/AFS_MC/AFS_onchanges/working")
agesex<-read.csv("data/auxi/agesex.csv")
agesex_wide<-reshape(agesex, idvar = "DataZone2011", timevar = "sex", direction = "wide")
agesex_wide$Mchildren<-with(agesex_wide, ageg04.M+ ageg1014.M + ageg1519.M)
agesex_wide$MAdult<-with(agesex_wide, ageg2024.M+ ageg2529.M + ageg3034.M + ageg3539.M+ ageg4044.M + ageg4549.M + ageg5054.M+ ageg5559.M)
agesex_wide$MOldAdult<-with(agesex_wide, ageg6064.M+ ageg6569.M + ageg7074.M +  ageg7579.M +  ageg8084.M +  ageg8589.M +  ageg90plus.M)
agesex_wide$Fchildren<-with(agesex_wide, ageg04.F+ ageg1014.F + ageg1519.F)
agesex_wide$FAdult<-with(agesex_wide, ageg2024.F+ ageg2529.F + ageg3034.F + ageg3539.F+ ageg4044.F + ageg4549.F + ageg5054.F+ ageg5559.F)
agesex_wide$FOldAdult<-with(agesex_wide, ageg6064.F+ ageg6569.F + ageg7074.F +  ageg7579.F +  ageg8084.F +  ageg8589.F +  ageg90plus.F)
library(gtools)
library(car)
library(plyr)
library(dplyr)
library(knitr)
Scotland<-readRDS("C:/Users/mcherrie/Google Drive/ProjectFiles/CRESHwebmap/alcoholtobacco/geography/DZ/la/Scotland.rds")
file.info(Scotland)
object.size(Scotland)
library(rgeos)
Scotland2<-gSimplify(Scotland, 3)
object.size(Scotland2)
Scotland2<-gSimplify(Scotland, 30)
object.size(Scotland2)
library(rgeos)
Scotland2<-gSimplify(Scotland, 100)
object.size(Scotland2)
library(rgeos)
Scotland2<-gSimplify(Scotland, 1000)
object.size(Scotland2)
library(rgeos)
Scotland2<-gSimplify(Scotland, 100)
object.size(Scotland2)
library(rgeos)
Scotland2<-gSimplify(Scotland, 120)
object.size(Scotland2)
library(rgeos)
Scotland2<-gSimplify(Scotland, 190)
object.size(Scotland2)
library(rgeos)
Scotland2<-gSimplify(Scotland, 220)
object.size(Scotland2)
library(rgeos)
Scotland2<-gSimplify(Scotland, 290)
object.size(Scotland2)
library(rgeos)
Scotland2<-gSimplify(Scotland, 350)
object.size(Scotland2)
library(rgeos)
Scotland2<-gSimplify(Scotland, 500)
object.size(Scotland2)
library(rgeos)
Scotland2<-gSimplify(Scotland, 400)
object.size(Scotland2)
plot(Scotland2)
Scotland2<-gSimplify(Scotland, 400, topologyPreserve = T)
object.size(Scotland2)
library(rgeos)
Scotland2<-gSimplify(Scotland, 9000, topologyPreserve = T)
object.size(Scotland2)
library(rgeos)
Scotland2<-gSimplify(Scotland, 900, topologyPreserve = T)
object.size(Scotland2)
library(rgeos)
Scotland2<-gSimplify(Scotland, 500, topologyPreserve = F)
object.size(Scotland2)
plot(Scotland2)
library(rgeos)
Scotland2<-gSimplify(Scotland, 100, topologyPreserve = F)
object.size(Scotland2)
plot(Scotland2)
library(rgeos)
Scotland2<-gSimplify(Scotland, 300, topologyPreserve = F)
object.size(Scotland2)
plot(Scotland2)
library(rgeos)
Scotland2<-gSimplify(Scotland, 300, topologyPreserve = T)
object.size(Scotland2)
object.size(Scotland)
library(rgeos)
Scotland2<-gSimplify(Scotland, 300, topologyPreserve = T)
object.size(Scotland2)
plot(Scotland2)
library(rgeos)
Scotland2<-gSimplify(Scotland, 1000, topologyPreserve = T)
object.size(Scotland2)
library(rgeos)
Scotland2<-gSimplify(Scotland, 1500, topologyPreserve = T)
object.size(Scotland2)
library(rgeos)
Scotland2<-gSimplify(Scotland, 15000, topologyPreserve = T)
object.size(Scotland2)
library(rgeos)
Scotland2<-gSimplify(Scotland, 14000, topologyPreserve = T)
object.size(Scotland2)
writeOGR(Scotland2, "C:/Users/mcherrie/Downloads/testOGR/", "ESRI Shapefile")
library(rgdal)
writeOGR(Scotland2, "C:/Users/mcherrie/Downloads/testOGR/", "ESRI Shapefile")
writeOGR(Scotland2, "C:/Users/mcherrie/Downloads/testOGR/", driver="ESRI Shapefile")
writeOGR(Scotland2, "C:/Users/mcherrie/Downloads/testOGR/", "Scotland2.shp", driver="ESRI Shapefile")
saveRDS(Scotland2,"C:/Users/mcherrie/Downloads/testOGR/Scotland2.rds")
Scotland@data
spdf <- SpatialPolygonsDataFrame(Scotland2, data =Scotland@data)
writeOGR(spdf, "C:/Users/mcherrie/Downloads/testOGR/", "Scotland2.shp", driver="ESRI Shapefile")
writeOGR(spdf, "C:/Users/mcherrie/Downloads/testOGR/", "Scotland2", driver="ESRI Shapefile")
?writeOGR
writeOGR(spdf, "C:/Users/mcherrie/Downloads/testOGR", "Scotland2", driver="ESRI Shapefile")
library(rgeos)
Scotland2<-gSimplify(Scotland, 140, topologyPreserve = T)
object.size(Scotland2)
spdf <- SpatialPolygonsDataFrame(Scotland2, data =Scotland@data)
writeOGR(spdf, "C:/Users/mcherrie/Downloads/testOGR", "Scotland2", driver="ESRI Shapefile")
spdf <- SpatialPolygonsDataFrame(Scotland2, data =Scotland@data)
writeOGR(spdf, "C:/Users/mcherrie/Downloads/testOGR", "Scotland2", driver="ESRI Shapefile")
library(rgeos)
Scotland2<-gSimplify(Scotland, 10, topologyPreserve = T)
object.size(Scotland2)
object.size(Scotland)
object.size(Scotland2)
saveRDS(Scotland2,"C:/Users/mcherrie/Downloads/testOGR/Scotland2.rds")
spdf <- SpatialPolygonsDataFrame(Scotland2, data =Scotland@data)
writeOGR(spdf, "C:/Users/mcherrie/Downloads/testOGR", "Scotland2", driver="ESRI Shapefile")
library(rgeos)
Scotland2<-gSimplify(Scotland, 20, topologyPreserve = T)
object.size(Scotland2)
saveRDS(Scotland2,"C:/Users/mcherrie/Downloads/testOGR/Scotland2.rds")
spdf <- SpatialPolygonsDataFrame(Scotland2, data =Scotland@data)
writeOGR(spdf, "C:/Users/mcherrie/Downloads/testOGR", "Scotland2", driver="ESRI Shapefile")
spdf <- SpatialPolygonsDataFrame(Scotland2, data =Scotland@data)
writeOGR(spdf, "C:/Users/mcherrie/Downloads/testOGR", "Scotland2", driver="ESRI Shapefile")
saveRDS(Scotland2,"C:/Users/mcherrie/Downloads/testOGR/Scotland2.rds")
readRDS((Scotland2,"C:/Users/mcherrie/Downloads/testOGR/Scotland2.rds"))
scotland<-readRDS(Scotland2,"C:/Users/mcherrie/Downloads/testOGR/Scotland2.rds")
scotland<-readRDS("C:/Users/mcherrie/Downloads/testOGR/Scotland2.rds")
scotland<-readRDS("C:/Users/mcherrie/Downloads/testOGR/Scotland.rds")
scotland<-readRDS("C:/Users/mcherrie/Downloads/testOGR/Scotland.rds")
scotlandold<-readRDS("C:/Users/mcherrie/Downloads/testOGR/ScotlandOLD.rds")
View(scotlandold)
View(Scotland2)
saveRDS(spdf,"C:/Users/mcherrie/Downloads/testOGR/Scotland3.rds")
subset <- Scotland@data
subset
names(subset)
subset<- subset(subset, select=c("Council", "datazone", "name", "Councilname"))
spdf <- SpatialPolygonsDataFrame(Scotland2, data =subset)
saveRDS(spdf,"C:/Users/mcherrie/Downloads/testOGR/Scotland3.rds")
subset <- Scotland@data
library(rgeos)
Scotland2<-gSimplify(Scotland, 20, topologyPreserve = T)
object.size(Scotland2)
subset <- Scotland@data
spdf <- SpatialPolygonsDataFrame(Scotland2, data =subset)
spdf@data[3:15]<-NA
subset <- Scotland@data
spdf <- SpatialPolygonsDataFrame(Scotland2, data =subset)
spdf@data[4:15]<-NA
object.size(Scotland2)
subset <- Scotland@data
spdf <- SpatialPolygonsDataFrame(Scotland2, data =subset)
spdf@data[4:15]<-NA
saveRDS(spdf,"C:/Users/mcherrie/Downloads/testOGR/Scotland3.rds")
Scotland2 <- rmapshaper::ms_simplify(Scotland, keep = 0.05)
plot(Scotland2)
Scotland2 <- rmapshaper::ms_simplify(Scotland, keep = 0.01)
object.size(Scotland2)
Scotland2 <- rmapshaper::ms_simplify(Scotland, keep = 0.005)
object.size(Scotland2)
plot(Scotland2)
plot(Scotland)
plot(Scotland2)
subset <- Scotland@data
spdf <- SpatialPolygonsDataFrame(Scotland2, data =subset)
spdf@data[4:15]<-NA
Scotland2 <- rmapshaper::ms_simplify(Scotland, keep = 0.05)
object.size(Scotland2)
object.size(Scotland)
Scotland2 <- rmapshaper::ms_simplify(Scotland, keep = 0.1)
object.size(Scotland2)
Scotland2 <- rmapshaper::ms_simplify(Scotland, keep = 0.4)
object.size(Scotland2)
object.size(Scotland)
Scotland2<-gSimplify(Scotland, 20, topologyPreserve = T)
object.size(Scotland2)
Scotland2 <- rmapshaper::ms_simplify(Scotland, keep = 0.01)
object.size(Scotland2)
Scotland2 <- rmapshaper::ms_simplify(Scotland, keep = 0.01, keep_shapes=T)
object.size(Scotland2)
plot(Scotland2)
Scotland2 <- rmapshaper::ms_simplify(Scotland, keep = 0.0001, keep_shapes=T)
object.size(Scotland2)
subset <- Scotland@data
spdf <- SpatialPolygonsDataFrame(Scotland2, data =subset)
spdf@data[4:15]<-NA
saveRDS(spdf,"C:/Users/mcherrie/Downloads/testOGR/Scotland3.rds")
Scotland<-readRDS("C:/Users/mcherrie/Downloads/testOGR/ScotlandOLD3.rds")
object.size(Scotland)
View(Scotland)
View(spdf)
subset <- Scotland@data
head(subset)
spdf <- SpatialPolygonsDataFrame(Scotland2, data =subset)
spdf@data[4:9]<-NA
spdf@data[11:15]<-NA
spdf
object.size(spdf)
object.size(Scotland)
Scotland2 <- rmapshaper::ms_simplify(Scotland, keep = 0.01, keep_shapes=T)
object.size(Scotland2)
subset <- Scotland@data
spdf <- SpatialPolygonsDataFrame(Scotland2, data =subset)
object.size(spdf)
spdf
subset
Scotland<-readRDS("C:/Users/mcherrie/Downloads/testOGR/ScotlandOLD3.rds")
object.size(Scotland)
subset <- Scotland@data
subset
Scotland<-readRDS("C:/Users/mcherrie/Downloads/testOGR/ScotlandOLD.rds")
object.size(Scotland)
Scotland2 <- rmapshaper::ms_simplify(Scotland, keep = 0.01, keep_shapes=T)
object.size(Scotland2)
subset <- Scotland@data
spdf <- SpatialPolygonsDataFrame(Scotland2, data =subset)
object.size(spdf)
head(spdf@data)
saveRDS(spdf,"C:/Users/mcherrie/Downloads/testOGR/Scotland3.rds")
setwd("~/")
Scotland2 <- rmapshaper::ms_simplify(Scotland, keep = 0.01, keep_shapes=T)
object.size(Scotland2)
subset <- Scotland@data
spdf <- SpatialPolygonsDataFrame(Scotland2, data =subset)
spdf@data[4:9]<-NA
spdf@data[11:15]<-NA
saveRDS(spdf,"C:/Users/mcherrie/Downloads/testOGR/Scotland3.rds")
spdf
View(spdf)
plot(spdf)
saveRDS(spdf,"C:/Users/mcherrie/Downloads/testOGR/Scotland3.rds")
Scotland2 <- rmapshaper::ms_simplify(Scotland, keep = 0.01, keep_shapes=T)
object.size(Scotland2)
subset <- Scotland@data
spdf <- SpatialPolygonsDataFrame(Scotland2, data =subset)
spdf@data
object.size(spdf)
subset <- Scotland@data
spdf <- SpatialPolygonsDataFrame(Scotland2, data =subset)
object.size(spdf)
spdf@data[4:9]<-NA
spdf@data[11:15]<-NA
object.size(spdf)
spdf@data
subset <- Scotland@data
spdf <- SpatialPolygonsDataFrame(Scotland2, data =subset)
spdf@data[4:10]<-NA
spdf@data[12:15]<-NA
object.size(spdf)
saveRDS(spdf,"C:/Users/mcherrie/Downloads/testOGR/Scotland3.rds")
Scotland<-readRDS("C:/Users/mcherrie/Downloads/testOGR/ScotlandOLD.rds")
object.size(Scotland)
#library(rgeos)
#Scotland2<-gSimplify(Scotland, 20, topologyPreserve = T)
Scotland2 <- rmapshaper::ms_simplify(Scotland, keep = 0.01, keep_shapes=T)
subset <- Scotland@data
spdf <- SpatialPolygonsDataFrame(Scotland2, data =subset)
object.size(spdf)
spdf@data
names(sodf)
names(spdf)
spdf <- SpatialPolygonsDataFrame(Scotland2, data =subset)
object.size(spdf)
spdf@data[4:10]<-NA
spdf@data[12:15]<-NA
spdf@data
saveRDS(spdf,"C:/Users/mcherrie/Downloads/testOGR/Scotland.rds")
writeOGR(spdf, "C:/Users/mcherrie/Downloads/testOGR", "Scotland3", driver="ESRI Shapefile")
shiny::runApp('C:/Users/mcherrie/Google Drive/ProjectFiles/CRESHwebmap/alcoholtobacco')
Scotland2 <- rmapshaper::ms_simplify(Scotland, keep = 0.2, keep_shapes=T)
subset <- Scotland@data
spdf <- SpatialPolygonsDataFrame(Scotland2, data =subset)
object.size(spdf)
spdf@data[4:10]<-NA
spdf@data[12:15]<-NA
saveRDS(spdf,"C:/Users/mcherrie/Downloads/testOGR/Scotland.rds")
shiny::runApp('C:/Users/mcherrie/Google Drive/ProjectFiles/CRESHwebmap/alcoholtobacco')
getwd()
setwd("C:/Users/mcherrie/Google Drive/ProjectFiles/CRESHwebmap/alcoholtobacco")
MortAdd<-read.csv("data/Mort.csv")
View(MortAdd)
MortAdd$Tobrelated_smr<-as.numeric(MortAdd$Tobrelated_smr)
MortAdd$Alcrelated_smr<-as.numeric(MortAdd$Alcrelated_smr)
MortAdd$Alcrelated_smr2<-quantcut(MortAdd$Alcrelated_smr, 5)
levels(MortAdd$Alcrelated_smr2)<-sub("\\(|\\[|\\]", "", levels(MortAdd$Alcrelated_smr2))
levels(MortAdd$Alcrelated_smr2)<-sub("\\]", "", levels(MortAdd$Alcrelated_smr2))
levels(MortAdd$Alcrelated_smr2)<-sub(",", " and ", levels(MortAdd$Alcrelated_smr2))
ScottishMortAlc90<-quantile(MortAdd$Alcrelated_smr, c(.90), na.rm=T)
ScottishMortAlc90
runApp()
runApp()
runApp()
MortAdd<-read.csv("data/Mort.csv")
MortAdd$Tobrelated_smr<-as.numeric(MortAdd$Tobrelated_smr)
MortAdd$Alcrelated_smr<-as.numeric(MortAdd$Alcrelated_smr)
View(MortAdd)
MortAdd$Alcrelated_smr2<-quantcut(MortAdd$Alcrelated_smr, 5)
levels(MortAdd$Alcrelated_smr2)<-sub("\\(|\\[|\\]", "", levels(MortAdd$Alcrelated_smr2))
levels(MortAdd$Alcrelated_smr2)<-sub("\\]", "", levels(MortAdd$Alcrelated_smr2))
levels(MortAdd$Alcrelated_smr2)<-sub(",", " and ", levels(MortAdd$Alcrelated_smr2))
MortAdd$Tobrelated_smr2<-quantcut(MortAdd$Tobrelated_smr, 5)
levels(MortAdd$Tobrelated_smr2)<-sub("\\(|\\[|\\]", "", levels(MortAdd$Tobrelated_smr2))
levels(MortAdd$Tobrelated_smr2)<-sub("\\]", "", levels(MortAdd$Tobrelated_smr2))
levels(MortAdd$Tobrelated_smr2)<-sub(",", " and ", levels(MortAdd$Tobrelated_smr2))
HospAdd<-read.csv(paste0("data/Hosp.csv"))
View(HospAdd)
runApp()
runApp()
runApp()
getwd()
